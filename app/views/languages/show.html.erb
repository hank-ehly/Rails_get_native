<div class="languages show main">
	<div class="container">

		<h1><%= @language.name %></h1>

		<h2>
			<%= link_to "Topics" %>
			|
			<%= link_to "Speakers" %>
			|
			<%= link_to "All Videos" %>
		</h2>

		<h3>Topics</h3>
		<table class="table">
			<thead>
				<th>Topic name</th>
				<th># of videos in specified language</th>
			</thead>

			<% @language.topics.order("topics.name ASC").each do |topic| %>

			<tr>
				<td><%= topic.name %></td>
				<td><%= Video.where(language_id: @language.id, topic_id: topic.id).count %></td>
			</tr>

			<% end %>


		</table>

		<hr>
		
		<h3>Speakers</h3>
		<table class="table">
			<thead>
				<th>Picture</th>
				<th>Name</th>
				<th>Age</th>
				<th>Gender</th>
				<th>Video Count</th>
			</thead>
			<% @language.speakers.each do |speaker| %>
			<tr>
				<td>
				<% video = speaker.videos.first %>
				<% 
				url_queries = Rack::Utils.parse_query URI(video.original_url).query
  			video_url = url_queries["v"] 
				%>
				<%= link_to controller: 'speakers', action: 'show', id: speaker.id do %>
					<img src=<%= get_thumbnail(video_url) %> alt="">
				<% end %>
				</td>
				<td><%= full_name_of(speaker) %></td>
				<td><%= age_range_of(speaker) %></td>
				<td><%= speaker.gender ? 'Male' : 'Female' %></td>
				<td><%= speaker.videos.count %></td>
			</tr>
			<% end %>
		</table>

<hr>

		<!-- <table class="table">
			<tr>
				<th>Name</th>
				<th># of Videos</th>
				<th># of Speakers</th>
				<% if @layout_style == 'Admin' %>
				<th>Id</th>
				<th>Created At</th>
				<th>Updated At</th>
				<th>Actions</th>
				<% end %>
			</tr>
			<tr>
				<td><%= @language.name %></td>
				<td><%= @language.videos.count %></td>
				<td><%= @language.speakers.count %></td>
				<% if @layout_style == 'Admin' %>
				<td><%= @language.id %></td>
				<td><%= @language.created_at %></td>
				<td><%= @language.updated_at %></td>
				<td>
					<%= link_to "Edit", controller: 'languages', action: 'edit', id: @language.id %>
					<%= link_to "Delete", controller: 'languages', action: 'delete', id: @language.id %>
				</td>
				<% end %>
			</tr>
		</table> 
-->

		<h3>All Videos</h3>
		<table class="table">
			<thead>
				<th>Video</th>
				<th>Topic</th>
				<th>Speaker</th>
			</thead>
			<% @language.videos.each do |video| %>
				<% 
				url_queries = Rack::Utils.parse_query URI(video.original_url).query
  			video_url = url_queries["v"] 
  			%>
				<tr>
					<td>
						<%= link_to controller: 'videos', action: 'show', id: video.id do %>
							<img src=<%= get_thumbnail(video_url) %> alt="">
						<% end %>
					</td>
					<td>
						<%= link_to controller: 'topics', action: 'show', id: video.topic.id do %>
							<%= video.topic.name %>
						<% end %>
					</td>
					<td>
						<%= link_to controller: 'speakers', action: 'show', id: video.speaker.id do %>
							<%= full_name_of(video.speaker) %>
						<% end %>
					</td>
				</tr>
			<% end %>
		</table>
	</div>
</div>